<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <style>
    .box {
      width: 322px;
      position: fixed;
      bottom: 0;
      right: 0;
      overflow: hidden;
    }
    
    span {
      position: absolute;
      top: 0;
      right: 0;
      width: 30px;
      height: 20px;
      cursor: pointer;
    }
    
    #headPart {
      overflow: hidden;
    }
  </style>
</head>
<body>
<div class="box" id="box">
  <!--要操作的关闭按钮-->
  <span id="closeButton"></span>
  
  <div class="hd" id="headPart">
    <img src="images/t.jpg" alt=""/>
  </div>
  <div class="bd" id="bottomPart">
    <img src="images/b.jpg" alt=""/>
  </div>
</div>

<script>
  //步骤：
  //1 点击按钮
  //2 让底部盒子高度运动为0
  //3 让整体父盒子宽度运动为0
  //4 删除box
  
  //实现：
  //1 获取元素
  var box = document.getElementById("box");
  var closeBtn = box.children[0];//删除按钮
  var bottomPart = box.children[2];//底部盒子
  
  //2 设置点击操作
  closeBtn.onclick = function () {
    animate(bottomPart, {height: 0}, function () {
      animate(box, {width: 0}, function () {
        document.body.removeChild(box);
      });
    });
  };
  
  
  /**
   * 让某个元素的某个(些)样式运动到指定值，可设置后续操作。
   * @param tag 要进行运动的元素，必选。
   * @param obj 对象，表示要运动的样式以及运动的目标值，必选。
   * @param fn 回调函数，需要一个函数值，表示运动完毕后要执行的代码，可选参数。
   */
  function animate(tag, obj, fn) {
    clearInterval(tag.timer);//防止加速
    tag.timer = setInterval(function () {
      //1 哪次定时器执行时要进行清除不确定，假设本次可以清除
      var flag = true;
      
      //以前只有一组样式运动，现在是多组样式要进行运动了。
      for (var k in obj) {
        //k - 属性名 - 要运动的样式名styleName
        //obj[k] - 属性值 - 目标位置target
        var styleName = k;
        var target = obj[k];
        
        //可以让某个样式运动到指定的值
        var current = parseInt(getStyle(tag, styleName)) || 0;
        var step = (target - current) / 10;
        step = step > 0 ? Math.ceil(step) : Math.floor(step);
        current = current + step;
        //需要修改的位置2：设置样式
        tag.style[styleName] = current + "px";
        
        /*//每个样式要运动的距离不同，导致了运动的速度不同，如果在某个样式进行运动时，到达了指定位置后进行定时器了清除，可能导致运动没有完全完毕。
         if (current == target) {
         clearInterval(tag.timer);
         }*/
        
        //2 如果某个样式没有到达指定位置，阻止清除
        if (current != target) {
          flag = false;
        }
      }
      //3 根据flag的值，执行代码
      if (flag) {
        clearInterval(tag.timer);
        
        //清除定时器后，可以确保运动完毕了。
        //完成我得各种需求：
        //1 运动完毕后，弹出一个提示框
//        alert("我是弹框");
        //2 运动完毕后，打印一段内容
        //console.log("我是文字")
        //3 运动完毕后，执行新的运动
        //animate(box,{
        //  width:120,
        //  height:230,
        //  top:100,
        //  left:400
        //});
        
        //animate函数的整体功能一定，但是运动完毕后要执行的代码不确定，可以传入函数参数。（回调函数）
        //运动完毕要做的事情可能没有设置，调用前需要检测fn是否存在
        //if(typeof fn == "function"){
        //  fn();
        //}
        
        //简化写法，不太严谨
        fn && fn();
      }
      
    }, 20);
  }
  
  //  console.log(getStyle(box, "width"));
  //  console.log(getStyle(box, "left"));
  
  function getStyle(tag, styleName) {
    if (tag.currentStyle) {
      return tag.currentStyle[styleName];
    } else {
      return getComputedStyle(tag)[styleName];
    }
  }
</script>
</body>
</html>
